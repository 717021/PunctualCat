<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>PunctualCat</title>
  <link rel="stylesheet" href="css/pages.css" type="text/css" />
</head>
<body>
  <div class="full-center" style="height: calc(100% - 70px);">
    <img src="img/404.svg" width="70" />
    <span id="global-error-info-text" class="text-secondary mb-3">抱歉，程序出现了一个错误导致停止运行，稍后我们将为您重启程序</span>
    <div class="stat">
      <i class="loading"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M512 981.312a469.312 469.312 0 1 0-445.824-322.24A42.688 42.688 0 1 0 147.2 632.32 384 384 0 1 1 512 896a42.688 42.688 0 1 0 0 85.312z" fill="#fff"></path></svg></i>
      <span id="global-error-info-stat" >请稍后</span>
    </div>
  </div>
  <script>
  window.onload = function() {
    var stat = document.getElementById('global-error-info-stat');
    stat.innerText = '正在收集错误信息...';
    setTimeout(() => {
      document.getElementById('global-error-info-text').innerHTML += '<br/>我们将会努力修改程序，防止错误再次发生';
      stat.innerText = '正在提交错误信息...';
      setTimeout(() => {
        stat.innerText = '正在为您重启程序';
        setTimeout(() => {
          if(typeof require != 'undefined'){
            require('electron').ipcRenderer.send('main-act-recreate');
            window.close();
          }
          else {
            document.getElementById('global-error-info-text').innerText = '暂时无法为您重启程序，请手动重启';
            var sec = 15;
            var timer = setInterval(() => {
              sec--;
              stat.innerText  = '程序将在 ' + sec + ' 秒后退出';
              if(sec==0){
                clearInterval(timer);
                window.close();
              }
            }, 1000);
          }
        }, 2000);
      }, 4000);
    }, 3000);
  };
  </script>
</body>
</html>
